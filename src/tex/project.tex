% Pacotes e configurações padrão do estilo ``article''\
% -------------------------------------
\documentclass[a4paper,11pt]{article}
% Layout
% ------------------------------------------------------------------------------
\input{relat_layout.tex}

%\usepackage{circuitikz}

\title{Proposta de projeto - Controle discreto de um motor DC} % Define o título do Relatório
\author{Rafael Lima}

% Definições Auxiliares ( Macros próprias )
% ------------------------------------------------------------------------------
%\input{relat_aux.tex} % Arquivo com minhas macros
% ----------------------------------~>ø<~---------------------------------------
\begin{document}
% Capa e Índice ----------------------------------------------------------------
\input{relat_capa.tex} % Capa para UnB
% Conteúdo ---------------------------------------------------------------------

\section{Introdução}

A presente proposta de projeto propõe o desenvolvimento de um sistema de controle discreto para uma planta composta por um motor DC (motor de corrente contínua), um sistema de redução e um sensor encoder de maneira a permitir o controle da posição a partir de um sinal de referência.

O motor de corrente contínua é amplamente utilizado em projetos de eletrônica e sua modelagem também está muito bem descrita na literatura de controle em geral. 

Pretende-se aplicar ao fim do desenvolvimento o controlador projetado em uma planta real. O conjunto de peças foi retirada de um equipamento antigo que havia sido descartado. Para implementação do controle, além da planta será utilizado um Arduino UNO e uma módulo com uma ponte H para o controle de potência conforme mostrado na figura \ref{fig:dispositivos}.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=0.8\linewidth]{src/tex/img/servomotor.jpg}
        \caption{Conjunto Motor DC + Encoder}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\linewidth}
        \centering
        \includegraphics[height=0.9\linewidth, angle=90]{src/tex/img/arduinoUNO.jpg}
        \caption{Arduino UNO}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=0.9\linewidth]{src/tex/img/ponteH.jpg}
        \caption{Ponte H}
    \end{subfigure}
    \caption{Peças para proposta da planta}
    \label{fig:dispositivos}
\end{figure}

\section{Justificativa}

Sistemas de posicionamento utilizando motores de corrente contínua está presente nos mais variados equipamentos presentes nos dia de hoje. Isso se dá pois eles possuem bom custo benefício, sua implementação e manutenção são facilitadas.

Sua complexidade é razoável para o contexto da disciplina de Controle de Digital pois temos nesse sistema pelo menos dois atrasos nos elementos de atuação e sensoreamento. A caixa de redução por sua vez também insere um aspecto interessante ao processo, visto os efeitos de histerese e zona morta.

Do ponto de vista didático, esse sistema possui bons elementos a serem compreendidos no contexto da disciplina de Controle Digital. Podemos destacar as etapas de modelagem, discretização da planta, alocação de polos no domínio Z, projeto em LGR no domínio discreto de um controlador, identificação de sistema e implementação em uma planta real.

Por fim, o controle digital pressupõe um sistema computacional para sua execução, podendo ser operado por um microcontrolador disponível a custo acessível comercialmente. Isso torna esse projeto relevante no contexto das aplicações que utilizam motores de corrente contínua.


\section{Objetivos}

Propõe-se a obter nesse projeto os seguintes objetivos:

 \begin{enumerate}
   \item Obter modelo da planta no domínio da frequência (Motor DC em conjunto com caixa de redução);
   \item Obter modelo do sensor no domínio da frequência;
   \item Obter modelos discreto da Planta e do sensor
   \item Desenvolver modelo em \textit{Simulink} para o projeto
   \item Obter controlado descrito através de equações de diferenças;
   \item Implementação e Validação do controlador em teste em um sistema real;
 \end{enumerate}

\section{Metodologia de Projeto}

Para o desenvolvimento do projeto foram propostos as etapas relatadas a seguir. Primeiramente será uma revisão bibliográfica e modelagem da planta e avaliação em ambiente de simulação. Num segunda fase será ajustado o modelo encontrado para o planta real.

\begin{itemize}
    \item Estudo Planta Simulada
    \begin{enumerate}
        \item Revisão Bibliográfica para busca do modelo de um servo motor na literatura
        \item Simulação do modelo
        \item Implementação do controle em simulação
    \end{enumerate}
    \item Estudo Planta Real
    \begin{enumerate}
        \item Simulação da planta no \textit{Tinkercad}
        \item Identificação de Parâmetro da Planta
        \item Simulação da planta a partir do modelo identificado
        \item Implementação do controle em simulação
        \item Implementação do controle na planta
    \end{enumerate}
\end{itemize}

\section{Desenvolvimento}

\subsection{Implementação em Hardware}

Para garantir os requisitos necessários para a implementação do controlador em tempo discreto foi necessário implementar algumas funcionalidades do zero. Inicialmente tudo foi implementado no Tinkercad e posteriormente foi adotado o estudo direto na planta.

\subsubsection{Simulação no Tinkercad}

Como forma de prevenir danos as peças, foi utilizado o Tinkercad para simulação do sistema e como uma plataforma de estudos a respeito do comportamento do motor DC em conjunto com o encoder incremental. O Tinkercad foi escolhido por sua simplicidade de uso e facilidade de integração do circuito diretamente com a programação do Arduino.

\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{src/tex/img/pid_tinkercad.png}
    \caption{Diagrama Sistema implementado no Tinkercad}
    \label{fig:pid_tinkercad}
\end{figure}

Desta forma foi possível avaliar os algoritmos usados para a contagem de passo pelo encoder em conjunto com o acionamento do motor, cálculo do PID e detecção de sentido de rotação. Conforme ilustrado pela figura \ref{fig:pid_tinkercad}, foram utilizados potenciômetros para um ajuste manual e grosseiro dos ganhos do PID. Também foi adotado um display para mostrar os ganhos adotados. Com isto foi possível chegar a uma combinação de ganhos que permitia o motor alcançar o valor da referência ou ao menos parar após um tempo de movimento.

Dado as limitações da plataforma, principalmente nos modelos adotados para o motor e para comportamento das portas e ações do Arduíno não foi possível adotar nenhuma forma de identificação dos parâmetros. Concluído o estudo preliminar passamos para experimentos feitos diretamente na planta real.

\subsubsection{Temporização}

Como o estilo de controlador adotado pressupõe uma amostragem fixa, foi necessário adotar um controle de temporização estrito como forma de garantir que tanto o acionamento como a leitura do encoder seria feita dentro do tempo adequado. A leitura de cada passo do encoder é feita através de interrupção e a frequência de acionamento é feita a partir da comparação do valor de tempo para o instante atual com temporizadores internos.

\subsubsection{Leitura Encoder}

O encoder presente na planta escolhida é incremental e com isto foi necessário adicionar ao código no Arduíno a contagem de passos a detecção de sentido de rotação. A partir da captura de dados movendo-se manualmente o eixo do motor foi detectado a presença de bastante ruído na leitura. Com isto o contador acabava sendo incrementado ainda que o motor estivesse parado.

\subsubsection{Acionamento Motor}

O acionamento do motor foi feito através de uma ponte H. Um fato quer introduz não linearidade ao sistema é a presença de uma zona morta correspondente ao mínimo de tensão necessária para fazer o motor girar partindo do repouso. Para o motor escolhido inicialmente, esta região era muito grande e dado o desgaste interno do motor e com isto a tensão mínima necessária era próxima de 5V, o que inviabilizava qualquer controle pois era o máximo fornecido pela fonte inicial adotada. Para garantir um bom funcionamento é necessário que o motor tenha a capacidade de partir do zero com a menor tensão possível, isto é que a zona morta seja pequena e por conta disto foi necessário a escolha de outro motor.

\section{Conclusão}

% ------------------------------------------------------------------------------
\newpage
% Referências
\addcontentsline{toc}{section}{Referências} % Adiciona linha no índice
\bibliographystyle{abbrv} % Define Estilo e gera bibliografia
\bibliography{references} % Adiciona Arquivo com Referências

% Acrescentadas no arquivo references.bib
% para usa-las no texto basta usar \citep{}
% para citar sem usar no texto basta usar \nocite{}
%\nocite{sympy}
%\nocite{pythontex}
\nocite{matlabcontrol}
\nocite{matlabsymbolic}
\nocite{ogata2010modern}

% ------------------------------------------------------------------------------
%\newpage
\section*{Anexos}
\addcontentsline{toc}{section}{Anexos} % Adiciona linha no indice
%\subsection*{Python}

%Para os cálculos e demonstrações foi utilizado o pacote \textit{Python}\TeX\ \cite{pythontex} para o \LaTeX\ em conjunto da bibliteca \textit{sympy}\cite{sympy}. Segue o script completo em python:

%\inputminted[xleftmargin=15pt,linenos,frame=single,framesep=5pt,breaklines=true]{python}{../python/exsim6.py}

%\newpage
\subsection*{Matlab}

\subsubsection*{Parte 1}
Para o desenho dos gráficos e simulações foi utilizado o \textit{Matlab} em conjunto das toolbox \textit{Control System}\cite{matlabcontrol} e \textit{Symbolic Math}\cite{matlabsymbolic}. Segue o código referente usado

\inputminted[xleftmargin=15pt,linenos,frame=single,framesep=5pt,breaklines=true]{matlab}{../matlab/project.m}

\newpage
\subsection*{Arduino}
 Dado as limitações do Arduino foram produzidos diferentes códigos como forma de avaliar o funcionamento de cada componente de hardware isoladamente.

\subsubsection*{Teste Enconder}
Para avaliar o funcionamento do encoder foi usado o seguinte código
\inputminted[xleftmargin=15pt,linenos,frame=single,framesep=5pt,breaklines=true]{c++}{../arduino/test_enconder/test_enconder.ino}

\subsubsection*{Teste Motor}
Para avaliar o funcionamento do motor foi usado o seguinte código
\inputminted[xleftmargin=15pt,linenos,frame=single,framesep=5pt,breaklines=true]{c++}{../arduino/test_dcmotor/test_dcmotor.ino}


\subsubsection*{Controle}
Para implementação do controlador foi usado o seguinte código
\inputminted[xleftmargin=15pt,linenos,frame=single,framesep=5pt,breaklines=true]{c++}{../arduino/pid_control/pid_control.ino}

% https://www.usinainfo.com.br/drivers-para-motores/driver-ponte-h-ou-motor-de-passo-l298-2302.html
% ------------------------------------------------------------------------------
\end{document}
